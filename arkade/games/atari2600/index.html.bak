<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Atari 2600 - Kraken Arkade">
    <title>Atari 2600 Emulator - Kraken Arkade</title>
    <meta name="description" content="Play classic Atari 2600 games - Asteroids, Pitfall, River Raid, Space Invaders - Kraken Arkade">

    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.2/css/all.css">

    <style>
        /* Kraken Arkade Theme */
        :root {
            --kraken-bg: #0a0a1a;
            --kraken-accent: #0ff;
            --kraken-secondary: #1a0a2e;
        }

        * {
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, var(--kraken-bg) 0%, var(--kraken-secondary) 50%, #0a1a2e 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', system-ui, sans-serif;
            margin: 0;
            padding: 0;
        }

        /* Header */
        #header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 10px;
            padding: 20px 20px 0;
            max-width: 1200px;
            margin: 0 auto;
        }

        .back-link {
            color: var(--kraken-accent);
            text-decoration: none;
            font-size: 14px;
            opacity: 0.7;
            transition: opacity 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .back-link:hover { opacity: 1; }
        .back-link svg { width: 24px; height: 24px; }

        #subtitle {
            flex: 1;
            color: #fff;
        }

        .arkade-title {
            font-size: 24px;
            background: linear-gradient(135deg, #0ff, #f0f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: bold;
        }

        .game-title {
            display: block;
            font-size: 14px;
            color: #888;
            margin-top: 2px;
        }

        /* Page Layout */
        .page-wrapper {
            display: flex;
            gap: 15px;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Game Library Sidebar */
        .game-library {
            width: 180px;
            flex-shrink: 0;
            background: rgba(0, 15, 30, 0.9);
            border: 1px solid #1a3a4a;
            border-radius: 12px;
            padding: 10px;
            max-height: calc(100vh - 100px);
            overflow-y: auto;
            position: sticky;
            top: 20px;
        }

        .game-library.collapsed {
            width: 40px;
            padding: 10px 5px;
        }

        .library-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #1a3a4a;
        }

        .library-header h3 {
            color: var(--kraken-accent);
            font-size: 12px;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .game-library.collapsed .library-header h3 {
            display: none;
        }

        .library-toggle {
            background: none;
            border: none;
            color: var(--kraken-accent);
            cursor: pointer;
            padding: 4px;
            font-size: 14px;
        }

        .game-card {
            background: rgba(0, 30, 50, 0.6);
            border: 1px solid #1a3a4a;
            border-radius: 8px;
            padding: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .game-card:hover {
            border-color: var(--kraken-accent);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .game-card.active {
            border-color: #0f0;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
        }

        .game-card img {
            width: 100%;
            height: auto;
            border-radius: 4px;
            display: block;
            image-rendering: pixelated;
        }

        .game-card .game-name {
            color: #fff;
            font-size: 11px;
            font-weight: bold;
            margin-top: 6px;
            text-align: center;
        }

        .game-card .game-year {
            color: var(--kraken-accent);
            font-size: 9px;
            text-align: center;
            margin-top: 2px;
        }

        .game-library.collapsed .game-card {
            padding: 4px;
        }

        .game-library.collapsed .game-card img {
            width: 32px;
            height: 32px;
            object-fit: cover;
        }

        .game-library.collapsed .game-name,
        .game-library.collapsed .game-year {
            display: none;
        }

        /* Emulator Main Area */
        .emulator-main {
            flex: 1;
            min-width: 0;
        }

        /* Javatari Screen Container */
        #javatari {
            text-align: center;
        }

        #javatari-screen {
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.2);
            border-radius: 8px;
            overflow: hidden;
        }

        /* Loading indicator for games */
        .game-card.loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .game-card.loading::after {
            content: 'Loading...';
            display: block;
            text-align: center;
            color: var(--kraken-accent);
            font-size: 10px;
            margin-top: 4px;
        }

        /* Controls Panel (Right Side) */
        .controls-panel {
            width: 200px;
            flex-shrink: 0;
            background: rgba(0, 15, 30, 0.9);
            border: 1px solid #1a3a4a;
            border-radius: 12px;
            padding: 12px;
            max-height: calc(100vh - 100px);
            overflow-y: auto;
            position: sticky;
            top: 20px;
        }

        .controls-panel h3 {
            color: var(--kraken-accent);
            font-size: 12px;
            margin: 0 0 12px 0;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid #1a3a4a;
            padding-bottom: 8px;
        }

        .current-game-name {
            color: #fff;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 12px;
            text-align: center;
        }

        .no-game-loaded {
            color: #666;
            font-size: 12px;
            text-align: center;
            padding: 20px 10px;
        }

        .control-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid rgba(26, 58, 74, 0.5);
            font-size: 11px;
        }

        .control-item:last-child {
            border-bottom: none;
        }

        .control-action {
            color: #aaa;
        }

        .control-key {
            color: var(--kraken-accent);
            font-family: monospace;
            font-weight: bold;
        }

        .game-tips {
            background: rgba(0, 40, 60, 0.4);
            border-radius: 6px;
            padding: 10px;
            margin-top: 12px;
        }

        .game-tips h4 {
            color: #fa0;
            font-size: 10px;
            margin: 0 0 6px 0;
        }

        .game-tips p {
            color: #888;
            font-size: 10px;
            margin: 0;
            line-height: 1.4;
        }

        .game-trivia {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #1a3a4a;
        }

        .game-trivia h4 {
            color: #f0f;
            font-size: 10px;
            margin: 0 0 8px 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .trivia-item {
            color: #999;
            font-size: 10px;
            line-height: 1.4;
            margin-bottom: 8px;
            padding-left: 12px;
            position: relative;
        }

        .trivia-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 6px;
            width: 4px;
            height: 4px;
            background: #0ff;
            border-radius: 50%;
        }

        /* Emulator Help Text */
        .emulator-help {
            background: rgba(0, 30, 50, 0.6);
            border: 1px solid #1a3a4a;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            color: #888;
            font-size: 11px;
        }

        .emulator-help h4 {
            color: var(--kraken-accent);
            margin: 0 0 10px 0;
            font-size: 12px;
        }

        .emulator-help kbd {
            background: #1a3a4a;
            color: var(--kraken-accent);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 10px;
        }

        .help-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div id="header">
        <a href="/arkade/" class="back-link">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
            Arkade
        </a>
        <div id="subtitle">
            <span class="arkade-title">Atari 2600</span>
            <span class="game-title" id="header-game-title">Select a game from the library</span>
        </div>
    </div>

    <div class="page-wrapper">
        <!-- Game Library Sidebar -->
        <div class="game-library" id="game-library">
            <div class="library-header">
                <h3>Games</h3>
                <button class="library-toggle" onclick="toggleLibrary()" title="Toggle sidebar">
                    <i class="fas fa-chevron-left" id="library-toggle-icon"></i>
                </button>
            </div>
            <div id="game-list">
                <!-- Games will be populated by JavaScript -->
            </div>
        </div>

        <!-- Emulator Main Area -->
        <div class="emulator-main">
            <div id="javatari">
                <div id="javatari-screen"></div>
            </div>

            <div class="emulator-help">
                <h4>Emulator Controls</h4>
                <div class="help-row"><span>Power On/Off</span><kbd>Alt+P</kbd></div>
                <div class="help-row"><span>Game Select</span><kbd>Alt+1</kbd></div>
                <div class="help-row"><span>Game Reset</span><kbd>Alt+2</kbd></div>
                <div class="help-row"><span>Pause</span><kbd>Alt+P</kbd></div>
                <div class="help-row"><span>Fullscreen</span><kbd>Alt+Enter</kbd></div>
                <div class="help-row"><span>Settings</span><kbd>Alt+S</kbd></div>
            </div>
        </div>

        <!-- Controls Panel -->
        <div class="controls-panel">
            <h3>Controls</h3>
            <div id="no-game-msg" class="no-game-loaded">
                Select a game from the library to see controls
            </div>
            <div id="game-controls" style="display: none;">
                <div class="current-game-name" id="current-game-name"></div>
                <div id="controls-list"></div>
                <div class="game-tips" id="game-tips" style="display: none;">
                    <h4>Tips</h4>
                    <p id="tips-text"></p>
                </div>
                <div class="game-trivia" id="game-trivia" style="display: none;">
                    <h4>Did You Know?</h4>
                    <div id="trivia-list"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Javatari Configuration -->
    <script>
        // Configure Javatari before loading
        Javatari = {
            SCREEN_ELEMENT_ID: "javatari-screen",
            CARTRIDGE_URL: "",
            AUTO_START: true,
            SCREEN_DEFAULT_SCALE: -1,
            PAGE_BACK_CSS: "transparent"
        };
    </script>
    <script src="javatari.js"></script>

    <script>
        // ============================================
        // GAME LIBRARY CONFIGURATION
        // ============================================
        const gameLibrary = [
            {
                id: 'asteroids',
                name: 'Asteroids',
                year: '1981',
                publisher: 'Atari',
                thumbnail: 'thumbnails/asteroids.png',
                rom: 'roms/Asteroids [no copyright].bin',
                controls: [
                    { action: 'Rotate Left', key: 'Left / D-Pad' },
                    { action: 'Rotate Right', key: 'Right / D-Pad' },
                    { action: 'Thrust', key: 'Up / D-Pad' },
                    { action: 'Fire', key: 'Space / A Button' },
                    { action: 'Hyperspace', key: 'Down / D-Pad' }
                ],
                tips: 'Shoot asteroids to break them into smaller pieces. Use hyperspace to escape - but it\'s risky! Small UFOs are more accurate shooters than large ones.',
                trivia: [
                    'First Atari 2600 game to use bankswitching, doubling ROM size from 4KB to 8KB.',
                    'The arcade version earned Atari $150 million, with arcade operators earning $500 million more from coins.',
                    'The two UFOs were nicknamed "Mr. Bill" and "Sluggo" after Saturday Night Live characters - until NBC sent a cease-and-desist!',
                    'Asteroids move mostly vertically due to 2600 hardware limitations.',
                    'World record holder Scott Safran (41 million points) tragically died at 23 trying to rescue his cat from a balcony.',
                    'Added to the Museum of Modern Art\'s permanent collection.',
                    'The arcade version had no sound chip - Howard Delman hand-wired 13 sound effects!',
                    'Displaced Space Invaders as the #1 arcade game in America.',
                    'Over 70,000 arcade cabinets were sold.',
                    'Named one of Time\'s All-Time 100 greatest video games in 2012.'
                ]
            },
            {
                id: 'pitfall',
                name: 'Pitfall!',
                year: '1982',
                publisher: 'Activision',
                thumbnail: 'thumbnails/pitfall.png',
                rom: 'roms/Pitfall! Jungle Adventure.bin',
                controls: [
                    { action: 'Move Left/Right', key: 'Left/Right / D-Pad' },
                    { action: 'Jump', key: 'Space / A Button' },
                    { action: 'Climb Vine', key: 'Up / D-Pad' },
                    { action: 'Descend', key: 'Down / D-Pad' }
                ],
                tips: 'You have 20 minutes to collect 32 treasures! Use underground passages to save time. Jump on crocodile heads when their mouths are closed!',
                trivia: [
                    'David Crane came up with the idea in 10 minutes, but it took 1,000 hours to program.',
                    'Crane had a running man animation for 3 years before finding the right game for it.',
                    'A young Jack Black starred in the TV commercial - his first acting role at age 13!',
                    'Sold over 4 million copies, making it one of the best-selling 2600 games.',
                    'The jungle setting was inspired by Raiders of the Lost Ark (1981).',
                    '255 screens are generated from just 50 bytes of ROM using procedural generation.',
                    'Originally had only 1 life - Crane\'s team "practically tied him to his chair" until he added extra lives.',
                    'Won "Best Adventure Video Game" at the 1983 Arkie Awards.',
                    'Crocodile-hopping was inspired by Heckle and Jeckle cartoons.',
                    'Perfect score is 114,000 points - collect all 32 treasures without losing points.'
                ]
            },
            {
                id: 'riverraid',
                name: 'River Raid',
                year: '1982',
                publisher: 'Activision',
                thumbnail: 'thumbnails/riverraid.png',
                rom: 'roms/River Raid.bin',
                controls: [
                    { action: 'Move Left/Right', key: 'Left/Right / D-Pad' },
                    { action: 'Accelerate', key: 'Up / D-Pad' },
                    { action: 'Decelerate', key: 'Down / D-Pad' },
                    { action: 'Fire', key: 'Space / A Button' }
                ],
                tips: 'Watch your fuel gauge! Fly over fuel depots to refuel. Destroy bridges to progress, but watch out for the narrow openings!',
                trivia: [
                    'Created by Carol Shaw - one of the first female video game designers in history.',
                    'Carol Shaw\'s name appeared on the box - first woman to receive such credit in gaming.',
                    'Was BANNED in Germany for being too violent - the first video game banned there!',
                    'The river goes on forever using procedural generation - there is no end!',
                    'Top-selling Activision game of 1983, second-best 2600 game after Ms. Pac-Man.',
                    'Shaw designed it on graph paper, choosing vertical scrolling because horizontal looked "jerky".',
                    'Won Best Action Videogame at the 1984 Arkie Awards.',
                    'Shaw was inducted into the Academy of Interactive Arts and Science Hall of Fame.',
                    'Atari\'s president once suggested Shaw design "cosmetics color matching" games. She ignored him.',
                    'A programmer said Shaw was "simply the best programmer of the 6502."'
                ]
            },
            {
                id: 'spaceinvaders',
                name: 'Space Invaders',
                year: '1980',
                publisher: 'Atari',
                thumbnail: 'thumbnails/spaceinvaders.png',
                rom: 'roms/Space Invaders.bin',
                controls: [
                    { action: 'Move Left', key: 'Left / D-Pad' },
                    { action: 'Move Right', key: 'Right / D-Pad' },
                    { action: 'Fire', key: 'Space / A Button' }
                ],
                tips: 'Shoot the invaders before they reach the bottom! The UFO at the top gives bonus points. Use your shields wisely - they can be destroyed!',
                trivia: [
                    'First licensed arcade-to-console port - and the first "killer app" for home consoles!',
                    'Quadrupled Atari 2600 sales, selling over 6 million copies.',
                    'The original arcade caused a 100-yen coin shortage in Japan!',
                    'Developer Rick Maurer only got an $11,000 bonus and quit - never made another 2600 game.',
                    'Features 112 game variations including invisible invaders and moving shields!',
                    'Hold RESET while powering on for a secret double-shot mode!',
                    'The 1980 Space Invaders Championship was the first major video game tournament - 10,000 participants!',
                    'Arcade version grossed $2 billion by 1982 (about $6.5 billion today).',
                    'The pixelated alien became a pop culture icon representing all video games.',
                    'Ushered in the "golden age of arcade games" and Japan\'s gaming dominance.'
                ]
            }
        ];

        let currentGame = null;

        // Toggle library sidebar
        function toggleLibrary() {
            const library = document.getElementById('game-library');
            const icon = document.getElementById('library-toggle-icon');
            library.classList.toggle('collapsed');
            if (library.classList.contains('collapsed')) {
                icon.classList.remove('fa-chevron-left');
                icon.classList.add('fa-chevron-right');
            } else {
                icon.classList.remove('fa-chevron-right');
                icon.classList.add('fa-chevron-left');
            }
        }

        // Build the game library UI
        function buildGameLibrary() {
            const container = document.getElementById('game-list');
            container.innerHTML = '';

            gameLibrary.forEach(function(game) {
                const card = document.createElement('div');
                card.className = 'game-card';
                card.dataset.gameId = game.id;
                card.onclick = function() { loadGame(game.id); };

                card.innerHTML = '<img src="' + game.thumbnail + '" alt="' + game.name + '" onerror="this.style.display=\'none\'">' +
                    '<div class="game-name">' + game.name + '</div>' +
                    '<div class="game-year">' + game.year + '</div>';

                container.appendChild(card);
            });
        }

        // Update controls panel
        function updateControlsPanel(game) {
            var noGameMsg = document.getElementById('no-game-msg');
            var gameControls = document.getElementById('game-controls');
            var gameName = document.getElementById('current-game-name');
            var controlsList = document.getElementById('controls-list');
            var gameTips = document.getElementById('game-tips');
            var tipsText = document.getElementById('tips-text');
            var gameTrivia = document.getElementById('game-trivia');
            var triviaList = document.getElementById('trivia-list');
            var headerTitle = document.getElementById('header-game-title');

            if (!game) {
                noGameMsg.style.display = 'block';
                gameControls.style.display = 'none';
                headerTitle.textContent = 'Select a game from the library';
                return;
            }

            noGameMsg.style.display = 'none';
            gameControls.style.display = 'block';
            gameName.textContent = game.name;
            headerTitle.textContent = game.name + ' (' + game.year + ') - ' + game.publisher;

            // Build controls list
            controlsList.innerHTML = '';
            if (game.controls) {
                game.controls.forEach(function(ctrl) {
                    var item = document.createElement('div');
                    item.className = 'control-item';
                    item.innerHTML = '<span class="control-action">' + ctrl.action + '</span>' +
                        '<span class="control-key">' + ctrl.key + '</span>';
                    controlsList.appendChild(item);
                });
            }

            // Show tips if available
            if (game.tips) {
                gameTips.style.display = 'block';
                tipsText.textContent = game.tips;
            } else {
                gameTips.style.display = 'none';
            }

            // Show trivia if available
            if (game.trivia && game.trivia.length > 0) {
                gameTrivia.style.display = 'block';
                triviaList.innerHTML = '';
                game.trivia.forEach(function(fact) {
                    var item = document.createElement('div');
                    item.className = 'trivia-item';
                    item.textContent = fact;
                    triviaList.appendChild(item);
                });
            } else {
                gameTrivia.style.display = 'none';
            }
        }

        // Load a game
        function loadGame(gameId) {
            var game = null;
            for (var i = 0; i < gameLibrary.length; i++) {
                if (gameLibrary[i].id === gameId) {
                    game = gameLibrary[i];
                    break;
                }
            }
            if (!game) return;

            // Update UI
            var cards = document.querySelectorAll('.game-card');
            for (var i = 0; i < cards.length; i++) {
                cards[i].classList.remove('active');
                if (cards[i].dataset.gameId === gameId) {
                    cards[i].classList.add('active', 'loading');
                }
            }

            // Load ROM using Javatari's API
            fetch(game.rom)
                .then(function(response) {
                    if (!response.ok) throw new Error('ROM not found');
                    return response.arrayBuffer();
                })
                .then(function(arrayBuffer) {
                    // Convert to Uint8Array
                    var romData = new Uint8Array(arrayBuffer);

                    // Load into Javatari
                    if (Javatari.room && Javatari.room.console) {
                        var cart = Javatari.room.console.cartridgeSocket;
                        if (cart) {
                            // Create cartridge from ROM data
                            var cartridge = Javatari.CartridgeCreator.createCartridgeFromRom(romData, game.name);
                            if (cartridge) {
                                cart.insert(cartridge, true);
                            }
                        }
                    }

                    currentGame = game;
                    updateControlsPanel(game);

                    // Remove loading state
                    var cards = document.querySelectorAll('.game-card');
                    for (var i = 0; i < cards.length; i++) {
                        cards[i].classList.remove('loading');
                    }
                })
                .catch(function(err) {
                    console.error('Error loading game:', err);
                    alert('Error loading game: ' + err.message);
                    var cards = document.querySelectorAll('.game-card');
                    for (var i = 0; i < cards.length; i++) {
                        cards[i].classList.remove('loading');
                    }
                });
        }

        // Initialize game library when DOM is ready
        document.addEventListener('DOMContentLoaded', buildGameLibrary);
    </script>
</body>
</html>
